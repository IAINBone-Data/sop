<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SOP IAIN Bone</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    body { font-family: 'Inter', sans-serif; display: flex; flex-direction: column; min-height: 100vh; }
    #main-app { flex-grow: 1; }
    html, body {
        scroll-behavior: smooth;
    }
  </style>
</head>
<body class="bg-slate-50">

  <!-- Custom Alert Modal -->
  <div id="custom-alert-modal" class="modal-overlay fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="w-full max-w-sm p-6 space-y-4 bg-white rounded-xl shadow-lg text-center transform transition-all">
        <div id="custom-alert-icon-container" class="mx-auto flex items-center justify-center h-12 w-12 rounded-full">
            <!-- Icon will be injected here -->
        </div>
        <p id="custom-alert-message" class="text-lg font-medium text-gray-700"></p>
        <button id="close-custom-alert" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">Tutup</button>
    </div>
</div>

  <!-- Modal Form Pengajuan SOP -->
  <div id="form-permohonan-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="w-full max-w-lg p-8 space-y-6 bg-white rounded-xl shadow-lg transform transition-all">
      <div class="text-center">
        <h1 class="text-2xl font-bold text-gray-800">Formulir Pengajuan SOP Baru</h1>
        <p class="text-gray-500">Silakan isi detail di bawah ini.</p>
      </div>
      <form id="permohonan-form" class="space-y-4">
        <div>
          <label for="form-unit" class="text-sm font-medium text-gray-700">Unit</label>
          <select id="form-unit" name="unit" required class="w-full px-4 py-2 mt-1 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <option value="" disabled selected>Pilih Unit</option>
            <option>Rektorat</option>
            <option>Biro AUAK</option>
            <option>Fakultas Syariah dan Hukum Islam</option>
            <option>Fakultas Tarbiyah</option>
            <option>Fakultas Ekonomi dan Bisnis Islam</option>
            <option>Fakultas Ushuluddin dan Dakwah</option>
            <option>Pascasarjana</option>
            <option>Lembaga Penjaminan Mutu</option>
            <option>Lembaga Penelitian dan Pengabdian Masyarakat</option>
            <option>Satuan Pengawasan Internal</option>
            <option>UPT TIPD</option>
            <option>UPT Perpustakaan</option>
            <option>UPT Bahasa</option>
            <option>UPT Mahad Al Jamiah</option>
          </select>
        </div>
        <div>
          <label for="form-nama-sop" class="text-sm font-medium text-gray-700">Nama SOP yang Diajukan</label>
          <input type="text" id="form-nama-sop" name="nama-sop" required placeholder="Contoh: SOP Pengajuan Cuti Akademik" class="w-full px-4 py-2 mt-1 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label for="form-file" class="text-sm font-medium text-gray-700">Unggah Dokumen (Opsional)</label>
          <input type="file" id="form-file" name="file" accept=".xlsx,.xls" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 mt-1">
          <p class="text-xs text-gray-500 mt-1">Format: .xlsx, .xls. Maksimal 1MB.</p>
        </div>
        <div id="form-error" class="text-sm text-center text-red-500 font-medium hidden"></div>
        <div class="flex items-center gap-4 pt-2">
          <button type="button" id="close-form-modal" class="w-full px-4 py-2 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">Batal</button>
          <button type="submit" id="submit-permohonan-button" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 flex items-center justify-center">
            <span id="submit-button-text">Kirim Ajuan</span>
            <span id="submit-spinner" class="hidden"><i class="fa fa-spinner fa-spin"></i></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Login -->
  <div id="login-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="w-full max-w-md p-8 space-y-6 bg-white rounded-xl shadow-lg transform transition-all" id="login-modal-content">
      <div class="text-center">
        <h1 class="text-2xl font-bold text-gray-800">Login Administrator</h1>
        <p class="text-gray-500">Silakan login untuk melanjutkan</p>
      </div>
      <form id="login-form" class="space-y-6">
        <div>
          <label for="username" class="text-sm font-medium text-gray-700">Username</label>
          <input type="text" id="username" name="username" required class="w-full px-4 py-2 mt-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div>
          <label for="password" class="text-sm font-medium text-gray-700">Password</label>
          <input type="password" id="password" name="password" required class="w-full px-4 py-2 mt-2 text-gray-700 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
        </div>
        <div id="login-error" class="text-sm text-center text-red-500 font-medium hidden"></div>
        <div class="flex items-center gap-4">
          <button type="button" id="close-login-modal" class="w-full px-4 py-2 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">Batal</button>
          <button type="submit" id="login-button" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">
            <span id="login-button-text">Login</span>
            <span id="login-spinner" class="hidden"><i class="fa fa-spinner fa-spin"></i></span>
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Filter -->
  <div id="filter-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="w-full max-w-sm p-6 space-y-6 bg-white rounded-xl shadow-lg transform transition-all">
        <h2 class="text-xl font-bold text-gray-800">Filter SOP</h2>
        <div class="space-y-4">
            <div>
                <label for="filter-unit-modal" class="text-sm font-medium text-gray-700">Unit</label>
                <select id="filter-unit-modal" class="w-full p-2 mt-1 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Semua Unit</option>
                </select>
            </div>
            <div>
                <label for="filter-fungsi-modal" class="text-sm font-medium text-gray-700">Fungsi</label>
                <select id="filter-fungsi-modal" class="w-full p-2 mt-1 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <option value="">Semua Fungsi</option>
                </select>
            </div>
        </div>
        <button id="close-filter-modal" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">Terapkan & Tutup</button>
    </div>
  </div>

  <!-- Modal Konfirmasi Reload -->
  <div id="confirm-reload-modal" class="modal-overlay fixed inset-0 z-[100] flex items-center justify-center bg-black bg-opacity-50 hidden">
    <div class="w-full max-w-sm p-6 space-y-4 bg-white rounded-xl shadow-lg text-center transform transition-all">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-blue-100">
            <i class="fas fa-sync-alt text-blue-600 text-xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900">Konfirmasi</h3>
        <p class="text-sm text-gray-500">Apakah Anda yakin ingin memuat ulang semua data SOP dari server?</p>
        <div class="flex items-center gap-4 pt-2">
            <button id="cancel-reload-button" class="w-full px-4 py-2 font-semibold text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300">Batal</button>
            <button id="confirm-reload-button" class="w-full px-4 py-2 font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700">Ya, Muat Ulang</button>
        </div>
    </div>
  </div>


  <div id="main-app">
    <header class="bg-white shadow-md sticky top-0 z-40">
      <div class="w-full px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <div class="flex items-center">
            <button id="hamburger-menu-button" class="p-2 rounded-md text-gray-600 hover:bg-gray-100">
              <i class="fas fa-bars"></i>
            </button>
            <a href="#" id="header-title-link" class="text-xl font-bold text-gray-800 ml-4">SOP IAIN Bone</a>
          </div>
          <div id="user-info-container" class="flex items-center gap-2">
            <!-- Tombol-tombol di header -->
          </div>
        </div>
      </div>
    </header>

    <div id="popup-menu" class="fixed top-0 left-0 w-64 h-full bg-white shadow-lg z-50 transform -translate-x-full transition-transform duration-300">
        <div class="p-4">
            <h2 class="text-xl font-bold border-b pb-2">Menu</h2>
            <ul id="main-menu-list" class="mt-4 space-y-2">
                <li><a href="#" id="home-link" class="flex items-center py-2 px-4 hover:bg-gray-100 rounded"><i class="fas fa-home w-6 mr-2"></i>Beranda</a></li>
                <li><a href="#" id="permohonan-link" class="flex items-center py-2 px-4 hover:bg-gray-100 rounded"><i class="fa-solid fa-square-plus"></i></i>Permohonan SOP</a></li>
                <li><a href="#" id="about-link" class="flex items-center py-2 px-4 hover:bg-gray-100 rounded"><i class="fas fa-info-circle w-6 mr-2"></i>Tentang</a></li>
                <li class="border-t pt-2 mt-2"><a href="https://iain-bone.ac.id" target="_blank" class="flex items-center py-2 px-4 hover:bg-gray-100 rounded"><i class="fas fa-globe w-6 mr-2"></i>Web IAIN Bone</a></li>
                <li><a href="https://layanan.iain-bone.ac.id/" target="_blank" class="flex items-center py-2 px-4 hover:bg-gray-100 rounded"><i class="fa-solid fa-bars"></i>Layanan Publik</a></li>
            </ul>
        </div>
    </div>
    <div id="menu-overlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden"></div>

    <main class="w-full p-4 sm:p-6 lg:p-8">
      
      <div id="list-view-container">
        <section class="w-full">
            <!-- [PERBAIKAN FINAL] Kontrol Pencarian dan Filter -->
            <!-- Kontrol Desktop (Satu Baris) -->
            <div class="hidden lg:flex items-center gap-4 mb-4">
                <h3 id="dataset-count" class="text-lg font-semibold text-gray-700 shrink-0 mr-auto"><i class="fa fa-spinner fa-spin"></i> Memuat data...</h3>
                
                <div class="relative">
                    <input type="search" id="search-input" placeholder="Cari Nama atau Nomor SOP..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 h-10" style="width: 350px;">
                    <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i class="fa fa-search text-gray-400"></i></div>
                </div>
                <select id="filter-unit" class="p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white h-10">
                    <option value="">Semua Unit</option>
                </select>
                <select id="filter-fungsi" class="p-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 bg-white h-10">
                    <option value="">Semua Fungsi</option>
                </select>
                <button id="reset-filter-button" class="bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 text-sm shrink-0 h-10">Reset</button>
                <button id="reload-dataset-button" class="bg-white border text-blue-600 hover:bg-gray-100 font-bold p-2 rounded-lg text-lg flex items-center justify-center h-10 w-10 shrink-0" title="Muat Ulang Data">
                    <i id="reload-icon" class="fas fa-sync-alt"></i>
                </button>
            </div>

            <!-- Kontrol Mobile (Tetap 2 Baris) -->
            <div class="block lg:hidden mb-4">
                <div class="flex items-center justify-between gap-4 mb-4">
                    <h3 id="dataset-count-mobile" class="text-lg font-semibold text-gray-700"><i class="fa fa-spinner fa-spin"></i> Memuat data...</h3>
                    <button id="reload-dataset-button-mobile" class="bg-white border text-blue-600 hover:bg-gray-100 font-bold p-2 rounded-lg text-lg flex items-center justify-center h-10 w-12 shrink-0" title="Muat Ulang Data">
                        <i id="reload-icon-mobile" class="fas fa-sync-alt"></i>
                    </button>
                </div>
                <div class="flex items-center gap-2 flex-grow">
                    <div class="relative flex-grow">
                        <input type="search" id="search-input-mobile" placeholder="Cari SOP..." class="w-full pl-10 pr-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none"><i class="fa fa-search text-gray-400"></i></div>
                    </div>
                    <button id="open-filter-button" title="Buka Filter" class="bg-white border text-gray-700 font-bold p-2 w-12 h-10 rounded-lg hover:bg-gray-100 text-sm flex items-center justify-center shrink-0">
                        <i class="fas fa-filter"></i>
                    </button>
                    <button id="reset-filter-button-mobile" title="Reset Filter" class="bg-white border text-gray-700 font-bold p-2 w-12 h-10 rounded-lg hover:bg-gray-100 text-sm flex items-center justify-center shrink-0">
                        <i class="fas fa-undo"></i>
                    </button>
                </div>
            </div>

            <div id="loading-indicator" class="text-center py-10"><i class="fa fa-spinner fa-spin fa-3x text-blue-500"></i><p class="mt-2 text-gray-600">Sedang memuat SOP...</p></div>
            <div class="bg-white rounded-lg shadow">
                <div class="overflow-x-auto hidden md:block">
                    <table class="w-full">
                        <thead class="bg-gray-50 border-b">
                            <tr>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600">Nomor SOP</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600">Nama SOP</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600">Unit</th>
                                <th class="p-4 text-left text-sm font-semibold text-gray-600">Fungsi</th>
                            </tr>
                        </thead>
                        <tbody id="dataset-list" class="divide-y">
                        </tbody>
                    </table>
                </div>
                <div id="dataset-cards-container" class="md:hidden divide-y">
                </div>
            </div>
            <div id="pagination-container" class="flex justify-center items-center mt-8 space-x-2"></div>
            <div id="no-data-message" class="hidden text-center py-10 bg-white rounded-lg shadow-md"><i class="fa-solid fa-database fa-3x text-gray-400"></i><p class="mt-4 text-lg font-semibold text-gray-700">Data Tidak Ditemukan</p><p class="mt-1 text-gray-500">Coba ubah kata kunci pencarian atau filter Anda.</p></div>
        </section>
      </div>
      
      <div id="detail-view-container" class="hidden">
        <div class="flex items-center justify-between mb-6">
            <button id="back-to-list-button" class="text-blue-600 hover:text-blue-800 font-semibold flex items-center"><i class="fas fa-arrow-left mr-2"></i>Kembali ke Daftar</button>
            <span id="detail-status" class="text-sm font-bold px-3 py-1 rounded-full hidden"></span>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-10 gap-8">
            <section class="order-1 lg:order-1 lg:col-span-3 bg-white p-6 rounded-lg shadow-md space-y-4">
                <h2 id="detail-title" class="text-xl font-bold text-gray-800"></h2>
                <p id="detail-uraian" class="text-gray-600 text-sm"></p>
                <div class="border rounded-lg p-4 flex items-center justify-between gap-4">
                    <i class="fas fa-file-pdf text-red-500 text-3xl"></i>
                    <a id="detail-download-link" href="#" target="_blank" class="text-blue-600 hover:text-blue-800 font-semibold">Unduh Dokumen</a>
                </div>
            </section>
            <section class="order-3 lg:order-2 lg:col-span-3 bg-white p-6 rounded-lg shadow-md self-start">
                <button id="toggle-metadata-button" class="w-full flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-800">Metadata</h3>
                    <i id="metadata-chevron" class="fas fa-chevron-down transition-transform duration-300"></i>
                </button>
                <div id="metadata-content" class="hidden pt-4 mt-4 border-t">
                    <table class="w-full text-sm text-left text-gray-600">
                        <tbody>
                            <tr class="border-b"><td class="py-2 font-semibold">Penandatangan</td><td id="meta-penandatangan" class="py-2 text-right"></td></tr>
                            <tr class="border-b"><td class="py-2 font-semibold">Unit</td><td id="meta-unit" class="py-2 text-right"></td></tr>
                            <tr class="border-b"><td class="py-2 font-semibold">Fungsi</td><td id="meta-fungsi" class="py-2 text-right"></td></tr>
                            <tr class="border-b"><td class="py-2 font-semibold">Tanggal Pembuatan</td><td id="meta-tanggal" class="py-2 text-right"></td></tr>
                            <tr id="meta-revisi-row" class="border-b hidden"><td class="py-2 font-semibold">Tanggal Revisi</td><td id="meta-diperbaharui" class="py-2 text-right"></td></tr>
                            <tr class="border-b"><td class="py-2 font-semibold">Tanggal Efektif</td><td id="meta-efektif" class="py-2 text-right"></td></tr>
                        </tbody>
                    </table>
                </div>
            </section>
            <div class="order-2 lg:order-3 lg:col-span-7 lg:col-start-4 lg:row-span-2 lg:row-start-1">
                <div id="table-preview-container" class="bg-white p-2 rounded-lg shadow-md h-full">
                    <div id="table-preview-content" class="w-full h-full">
                        <!-- Konten pratinjau (iframe) akan dimasukkan di sini -->
                    </div>
                </div>
            </div>
        </div>
      </div>

      <div id="about-view-container" class="hidden p-8 bg-white rounded-lg shadow-md">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">Tentang E-SOP IAIN Bone</h2>
        <p class="text-gray-700 leading-relaxed">
            Sistem E-SOP IAIN Bone adalah sebuah platform terpusat yang dirancang untuk mengelola dan menyajikan Standar Operasional Prosedur (SOP) dari berbagai unit kerja di lingkungan Institut Agama Islam Negeri (IAIN) Bone. Tujuan utama dari sistem ini adalah untuk mewujudkan tata kelola dokumen yang akurat, mutakhir, terpadu, dan dapat diakses dengan mudah oleh seluruh pemangku kepentingan.
        </p>
      </div>
      
      <div id="permohonan-view-container" class="hidden">
        <section class="w-full">
            <div class="flex items-center justify-between gap-4 mb-6">
                <h3 class="text-xl font-semibold text-gray-800">Daftar Permohonan SOP</h3>
                <button id="ajukan-sop-button-page" class="bg-blue-600 text-white hover:bg-blue-700 font-semibold px-4 py-2 rounded-lg flex items-center gap-2">
                    <i class="fas fa-plus"></i>
                    <span class="hidden sm:inline">Ajukan SOP</span>
                </button>
            </div>
            <div id="permohonan-loading-indicator" class="text-center py-10">
                <i class="fa fa-spinner fa-spin fa-3x text-blue-500"></i>
                <p class="mt-2 text-gray-600">Sedang memuat data permohonan...</p>
            </div>
            <div id="permohonan-content" class="hidden">
                <div class="bg-white rounded-lg shadow">
                    <div class="overflow-x-auto hidden md:block">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-600">ID Permohonan</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-600">Timestamp</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-600">Unit</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-600">Nama SOP Diajukan</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-600">Status</th>
                                    <th class="p-4 text-left text-sm font-semibold text-gray-600">Keterangan</th>
                                </tr>
                            </thead>
                            <tbody id="permohonan-table-body" class="divide-y"></tbody>
                        </table>
                    </div>
                    <div id="permohonan-cards-container" class="md:hidden divide-y"></div>
                </div>
                <div id="permohonan-no-data-message" class="hidden text-center py-10 bg-white rounded-lg shadow-md mt-4">
                    <i class="fa-solid fa-folder-open fa-3x text-gray-400"></i>
                    <p class="mt-4 text-lg font-semibold text-gray-700">Tidak Ada Data Permohonan</p>
                    <p class="mt-1 text-gray-500">Saat ini belum ada permohonan SOP yang tercatat.</p>
                </div>
            </div>
        </section>
      </div>
      
    </main>
  </div>

  <footer class="bg-white text-slate-600 text-sm text-center py-6 border-t">
    <p>&copy; 2025 - Dikelola oleh Biro AUAK IAIN Bone</p>
  </footer>
  
  <script src="app.js"></script>
</body>
</html>

